"
{
    "refactorings": {
        "store/src/main/java/org/apache/rocketmq/store/stats/BrokerStatsManager.java": [
            {
                "fromLine": 73,
                "toLine": 75,
                "oldContent": "private final HashMap<String, StatsItemSet> statsTable = new HashMap<>();\n    private final String clusterName;\n    private final boolean enableQueueStat;",
                "newContent": "private final HashMap<String, StatsItemSet> statsTable = new HashMap<>();\n    private final BrokerStatsContext brokerStatsContext;"
            },
            {
                "fromLine": 129,
                "toLine": 129,
                "oldContent": "        this.clusterName = brokerConfig.getBrokerClusterName();",
                "newContent": "        this.brokerStatsContext = new BrokerStatsContext(brokerConfig.getBrokerClusterName(), brokerConfig.isEnableDetailStat());"
            },
            {
                "fromLine": 131,
                "toLine": 131,
                "oldContent": "        this.clusterName = clusterName;",
                "newContent": "        this.brokerStatsContext = new BrokerStatsContext(clusterName, enableQueueStat);"
            },
            {
                "fromLine": 133,
                "toLine": 133,
                "oldContent": "        this.enableQueueStat = enableQueueStat;",
                "newContent": ""
            },
            {
                "fromLine": 608,
                "toLine": 610,
                "oldContent": "        this.statsTable.get(CONSUMER_REGISTER_TIME).addValue(this.clusterName, incValue, 1);\n    }\n\n    public void incProducerRegisterTime(final int incValue) {",
                "newContent": "        this.statsTable.get(CONSUMER_REGISTER_TIME).addValue(brokerStatsContext.getClusterName(), incValue, 1);\n    }\n\n    public void incProducerRegisterTime(final int incValue) {"
            },
            {
                "fromLine": 612,
                "toLine": 612,
                "oldContent": "        this.statsTable.get(PRODUCER_REGISTER_TIME).addValue(this.clusterName, incValue, 1);",
                "newContent": "        this.statsTable.get(PRODUCER_REGISTER_TIME).addValue(brokerStatsContext.getClusterName(), incValue, 1);"
            },
            {
                "fromLine": 649,
                "toLine": 649,
                "oldContent": "        this.statsTable.get(Stats.BROKER_PUT_NUMS).getAndCreateStatsItem(this.clusterName).getValue().add(1);",
                "newContent": "        this.statsTable.get(Stats.BROKER_PUT_NUMS).getAndCreateStatsItem(brokerStatsContext.getClusterName()).getValue().add(1);"
            },
            {
                "fromLine": 651,
                "toLine": 651,
                "oldContent": "        this.statsTable.get(Stats.BROKER_PUT_NUMS).getAndCreateStatsItem(this.clusterName).getValue().add(incValue);",
                "newContent": "        this.statsTable.get(Stats.BROKER_PUT_NUMS).getAndCreateStatsItem(brokerStatsContext.getClusterName()).getValue().add(incValue);"
            },
            {
                "fromLine": 653,
                "toLine": 653,
                "oldContent": "        this.statsTable.get(Stats.BROKER_GET_NUMS).getAndCreateStatsItem(this.clusterName).getValue().add(incValue);",
                "newContent": "        this.statsTable.get(Stats.BROKER_GET_NUMS).getAndCreateStatsItem(brokerStatsContext.getClusterName()).getValue().add(incValue);"
            },
            {
                "fromLine": 655,
                "toLine": 655,
                "oldContent": "        this.statsTable.get(BROKER_ACK_NUMS).getAndCreateStatsItem(this.clusterName).getValue().add(incValue);",
                "newContent": "        this.statsTable.get(BROKER_ACK_NUMS).getAndCreateStatsItem(brokerStatsContext.getClusterName()).getValue().add(incValue);"
            },
            {
                "fromLine": 657,
                "toLine": 657,
                "oldContent": "        this.statsTable.get(BROKER_CK_NUMS).getAndCreateStatsItem(this.clusterName).getValue().add(incValue);",
                "newContent": "        this.statsTable.get(BROKER_CK_NUMS).getAndCreateStatsItem(brokerStatsContext.getClusterName()).getValue().add(incValue);"
            },
            {
                "fromLine": 659,
                "toLine": 659,
                "oldContent": "        if (TopicValidator.isSystemTopic(topic)) {",
                "newContent": "        if (brokerStatsContext.isEnableQueueStat() && TopicValidator.isSystemTopic(topic)) {"
            },
            {
                "fromLine": 661,
                "toLine": 661,
                "oldContent": "        this.statsTable.get(BROKER_GET_NUMS_WITHOUT_SYSTEM_TOPIC).getAndCreateStatsItem(this.clusterName).getValue().add(incValue);",
                "newContent": "        this.statsTable.get(BROKER_GET_NUMS_WITHOUT_SYSTEM_TOPIC).getAndCreateStatsItem(brokerStatsContext.getClusterName()).getValue().add(incValue);"
            },
            {
                "fromLine": 667,
                "toLine": 667,
                "oldContent": "        if (TopicValidator.isSystemTopic(topic)) {",
                "newContent": "        if (brokerStatsContext.isEnableQueueStat() && TopicValidator.isSystemTopic(topic)) {"
            },
            {
                "fromLine": 669,
                "toLine": 669,
                "oldContent": "        this.statsTable.get(BROKER_PUT_NUMS_WITHOUT_SYSTEM_TOPIC).getAndCreateStatsItem(this.clusterName).getValue().add(incValue);",
                "newContent": "        this.statsTable.get(BROKER_PUT_NUMS_WITHOUT_SYSTEM_TOPIC).getAndCreateStatsItem(brokerStatsContext.getClusterName()).getValue().add(incValue);"
            }
        ]
    },
    "extractedClasses": {
        "store/src/main/java/org/apache/rocketmq/store/stats/BrokerStatsContext.java": "package org.apache.rocketmq.store.stats;\n\npublic class BrokerStatsContext {\n\n    private final String clusterName;\n    private final boolean enableQueueStat;\n\n    public BrokerStatsContext(String clusterName, boolean enableQueueStat) {\n        this.clusterName = clusterName;\n        this.enableQueueStat = enableQueueStat;\n    }\n\n    public String getClusterName() {\n        return clusterName;\n    }\n\n    public boolean isEnableQueueStat() {\n        return enableQueueStat;\n    }\n}"
    }
}"