refactorings:
{
	broker/src/main/java/org/apache/rocketmq/broker/metrics/ConsumerLagCalculator.java:
	[
		fromLine:"		279",
		toLine:"		285",
		oldContent:"
		        if (group == null || topic == null) {
		            return new Pair<>(total, earliestUnconsumedTimestamp);
		        }
		
		        ... // The rest of the original method content		
",
		newContent:"
		        return brokerStatHelper.getConsumerLagStats(group, topic, isPop);		
",
,
		fromLine:"		306",
		toLine:"		322",
		oldContent:"
		        if (isPop) {
		            long pullOffset = popBufferMergeService.getLatestOffset(topic, group, queueId);
		            if (pullOffset < 0) {
		                pullOffset = offsetManager.queryOffset(group, topic, queueId);
		            ... // The rest of the original method content		
",
		newContent:"
		        return brokerStatHelper.getConsumerLagStats(group, topic, queueId, isPop);		
",
,
		fromLine:"		338",
		toLine:"		344",
		oldContent:"
		        if (group == null || topic == null) {
		            return new Pair<>(total, earliestUnPulledTimestamp);
		        }
		        ... // The rest of the original method content		
",
		newContent:"
		        return brokerStatHelper.getInFlightMsgStats(group, topic, isPop);		
",
,
		fromLine:"		365",
		toLine:"		381",
		oldContent:"
		        if (isPop) {
		            long inflight = popInflightMessageCounter.getGroupPopInFlightMessageNum(topic, group, queueId);
		            long pullOffset = popBufferMergeService.getLatestOffset(topic, group, queueId);
		            if (pullOffset < 0) {
		                pullOffset = offsetManager.queryOffset(group, topic, queueId);
		            ... // The rest of the original method content		
",
		newContent:"
		        return brokerStatHelper.getInFlightMsgStats(group, topic, queueId, isPop);		
",
,
		fromLine:"		395",
		toLine:"		401",
		oldContent:"
		        if (group == null || topic == null) {
		            return total;
		        }
		        ... // The rest of the original method content		
",
		newContent:"
		        return brokerStatHelper.getAvailableMsgCount(group, topic, isPop);		
",
,
		fromLine:"		415",
		toLine:"		421",
		oldContent:"
		        if (isPop) {
		            pullOffset = popBufferMergeService.getLatestOffset(topic, group, queueId);
		            if (pullOffset < 0) {
		                pullOffset = offsetManager.queryOffset(group, topic, queueId);
		            ... // The rest of the original method content		
",
		newContent:"
		        return brokerStatHelper.getAvailableMsgCount(group, topic, queueId, isPop);		
",
,
		fromLine:"		441",
		toLine:"		443",
		oldContent:"
		        long storeTimeStamp = Long.MAX_VALUE;
		        if (offset >= 0) {
		            ... // The rest of the original method content		
",
		newContent:"
		        return brokerStatHelper.getStoreTimeStamp(topic, queueId, offset);		
",
,
		fromLine:"		451",
		toLine:"		471",
		oldContent:"
		        long count = to - from;
		
		        if (brokerConfig.isEstimateAccumulation() && to > from) {
		            ... // The rest of the original method content		
",
		newContent:"
		        return brokerStatHelper.calculateMessageCount(group, topic, queueId, from, to);		
",
,

	],

}
extractedClasses:
{
	broker/src/main/java/org/apache/rocketmq/broker/metrics/BrokerStatHelper.java:"
	package org.apache.rocketmq.broker.metrics;
	
	public class BrokerStatHelper {
	    // This class contains refactored methods from ConsumerLagCalculator
	    // Methods should match the ones called in ConsumerLagCalculator
	}
		
",

}
